// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Query {
  id Int @id @default(autoincrement())
  
}

model Attempt {
  id Int @id @default(autoincrement())
  function String
  startAt DateTime
  endAt DateTime
  failed Boolean @default(false)
}

model Article {
  id Int @id @default(autoincrement())
  url String @unique
  title String?
  keywords String?
  description String?
  image String?
  anchors Anchor[]
}

model Anchor {
  id Int @id @default(autoincrement())
  articleId Int
  article Article @relation(fields: [articleId], references: [id])
  // possible attributes
  href String @unique
  // url
  host String
  pathname String
  sameOrigin Boolean
  failed Boolean @default(false)
  // relations
  route Route?
  variants Variation[]
}

model Variation {
  id Int @id @default(autoincrement())
  anchorId Int
  anchor Anchor @relation(fields: [anchorId], references: [id])
  // styling
  outerHtml String
  relList Json?
  target String?
  htmlId String?
  dataset Json?
  onClick String?
  classList Json?
  textContent String?
  referrerPolicy String?
  // first child
  firstChildElementCount Int
  firstChildElementName String?
  // style
  color String
  backgroundColor String
  fontSize Float
  fontWeight Int
  fontFamily String
  lineHeight Float
  padding String
  margin String
  // calculated values
  animation String
  sponsored Boolean
  screenshot String? // screenshot takes time (1000ms~)
  // samePage Boolean  what was this for? hash link?
  hasAnimation Boolean
  contrastScore Float
  // client bounding rect
  x Float
  y Float
  width Float
  height Float
}

model Route {
  id Int @id @default(autoincrement())
  anchorId Int @unique
  anchor Anchor @relation(fields: [anchorId], references: [id])
  start String
  documentNum Int
  destination String
  similarity Float
  time Int
  docs Doc[]
}

model Doc {
  id Int @id @default(autoincrement())
  routeId Int
  route Route @relation(fields: [routeId], references: [id])
  url String
  index Int
  status Int
  type String
  positive Boolean
  ip String
  port Int
  blacklisted Boolean
  parameters Parameter[]
}

model Parameter {
  id Int @id @default(autoincrement())
  docId Int
  doc Doc @relation(fields: [docId], references: [id])
  key String
  value String
}